<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Live Code Editor â€” HTML â€¢ CSS â€¢ JS</title>
  <style>
    :root{
      --bg:#0b0b0f;           /* near-black background */
      --panel:#111217;        /* editor panels */
      --muted:#1a1b22;        /* borders / separators */
      --accent:#ff7a18;       /* orange accent */
      --accent-2:#ffa14d;     /* lighter orange */
      --text:#e8e8ee;         /* primary text */
      --subtl:#a5a7b4;        /* secondary text */
      --ok:#2ecc71;           /* success */
      --warn:#ffce4a;         /* warning */
      --err:#ff5c5c;          /* error */
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.45);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text); font: 15px/1.5 Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, sans-serif;
    }
    .app{
      display:grid; grid-template-rows: auto 1fr; height:100%; gap:14px; padding:16px; max-width:1400px; margin:0 auto;
    }
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 14px; background:linear-gradient(180deg, #0e0f14, #0b0b0f 60%);
      border:1px solid var(--muted); border-radius:var(--radius); box-shadow:var(--shadow);
    }
    .brand{display:flex; align-items:center; gap:10px; letter-spacing:.5px;}
    .dot{width:10px; height:10px; border-radius:999px; background:var(--accent); box-shadow:0 0 0 6px rgba(255,122,24,.1)}
    .title{font-weight:700}
    .subtitle{color:var(--subtl); font-size:12px}

    .wrap{display:grid; grid-template-columns: 1.1fr 1fr; gap:14px; min-height:0}
    .panel{
      background:var(--panel); border:1px solid var(--muted); border-radius:var(--radius); box-shadow:var(--shadow); display:flex; flex-direction:column; min-height:0;
    }
    .panel h2{margin:0; padding:12px 14px; font-size:13px; text-transform:uppercase; letter-spacing:.14em; color:var(--subtl); border-bottom:1px solid var(--muted)}

    .editors{display:grid; grid-template-rows: 1fr 1fr 1fr; gap:10px; padding:10px; min-height:0}
    .editor{
      display:grid; grid-template-rows: auto 1fr; background:#0f1016; border:1px solid var(--muted); border-radius:12px; min-height:0;
    }
    .editor .bar{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 10px; border-bottom:1px solid var(--muted);}
    .tag{font-family:var(--mono); font-size:12px; color:var(--accent-2)}
    textarea{
      width:100%; height:100%; background:transparent; border:0; color:var(--text); padding:12px; font-family:var(--mono); font-size:13px; line-height:1.5; outline:none; resize:vertical; min-height:90px;
    }

    .controls{display:flex; gap:8px; align-items:center}
    button, .toggle{
      border:1px solid var(--muted); background:#12131a; color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:600; letter-spacing:.3px; transition: transform .05s ease, border-color .2s ease; box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }
    button:hover{border-color:#262836}
    button:active{transform:translateY(1px)}
    .primary{background:linear-gradient(180deg, #171822, #111217); border-color:#252736}
    .primary .dot{width:8px; height:8px; background:var(--accent); margin-right:6px; border-radius:99px; display:inline-block}

    .toggle{display:flex; align-items:center; gap:8px; user-select:none}
    .toggle input{appearance:none; width:34px; height:22px; border-radius:999px; position:relative; background:#1a1b24; border:1px solid var(--muted); outline:none; cursor:pointer; transition:background .2s ease}
    .toggle input:checked{background:#201a14; border-color:#3a2a1b}
    .toggle input:before{content:""; position:absolute; inset:3px auto auto 3px; width:14px; height:14px; border-radius:999px; background:#6b6f82; transition: transform .2s ease, background .2s ease}
    .toggle input:checked:before{transform:translateX(12px); background:var(--accent)}

    .preview{position:relative; display:flex; flex:1; min-height:0}
    iframe{flex:1; width:100%; height:100%; border:0; background:white; border-radius:0 0 var(--radius) var(--radius)}
    .preview .bar{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 12px; border-bottom:1px solid var(--muted)}

    .status{font-size:12px; color:var(--subtl)}
    .status .live{color:var(--ok); font-weight:700}
    .status .paused{color:var(--warn); font-weight:700}

    .footer{display:flex; gap:10px; align-items:center}
    .footer small{color:var(--subtl)}

    .badge{display:inline-flex; align-items:center; gap:6px; padding:6px 8px; border-radius:8px; background:#14151c; border:1px solid var(--muted); font-size:12px; color:var(--subtl)}
    .kbd{font-family:var(--mono); background:#0e0f14; padding:2px 6px; border-radius:6px; border:1px solid var(--muted); color:#c9cbe0}

    @media (max-width: 1100px){
      .wrap{grid-template-columns: 1fr; grid-template-rows: auto auto}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <span class="dot" aria-hidden="true"></span>
        <div>
          <div class="title">Live Code Editor</div>
          <div class="subtitle">HTML â€¢ CSS â€¢ JavaScript â€” Black + Orange</div>
        </div>
      </div>
      <div class="controls">
        <label class="toggle" title="Toggle auto-run (Ctrl/Cmd + E)">
          <input id="autorun" type="checkbox" checked />
          <span>Autoâ€‘run</span>
        </label>
        <button id="run" class="primary" title="Run (Ctrl/Cmd + Enter)"><span class="dot"></span>Run</button>
        <button id="save" title="Save to browser">Save</button>
        <button id="load" title="Load from browser">Load</button>
        <button id="reset" title="Reset to starter code">Reset</button>
        <button id="export" title="Download one HTML file">Download</button>
      </div>
    </header>

    <div class="wrap">
      <section class="panel">
        <h2>Editors</h2>
        <div class="editors">
          <div class="editor" id="html-editor">
            <div class="bar"><span class="tag">index.html</span><span class="badge">Language <span class="kbd">HTML</span></span></div>
            <textarea id="html" spellcheck="false"></textarea>
          </div>
          <div class="editor" id="css-editor">
            <div class="bar"><span class="tag">styles.css</span><span class="badge">Language <span class="kbd">CSS</span></span></div>
            <textarea id="css" spellcheck="false"></textarea>
          </div>
          <div class="editor" id="js-editor">
            <div class="bar"><span class="tag">app.js</span><span class="badge">Language <span class="kbd">JS</span></span></div>
            <textarea id="js" spellcheck="false"></textarea>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="bar preview">
          <div class="status">Preview: <span id="state" class="live">LIVE</span></div>
          <div class="footer">
            <small>Shortcuts:</small>
            <span class="badge"><span class="kbd">Ctrl/âŒ˜</span> + <span class="kbd">Enter</span> Run</span>
            <span class="badge"><span class="kbd">Ctrl/âŒ˜</span> + <span class="kbd">E</span> Autoâ€‘run</span>
          </div>
        </div>
        <iframe id="frame" title="Live Preview" sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-presentation allow-same-origin allow-scripts"></iframe>
      </section>
    </div>
  </div>

  <script>
    const els = {
      html: document.getElementById('html'),
      css: document.getElementById('css'),
      js: document.getElementById('js'),
      frame: document.getElementById('frame'),
      run: document.getElementById('run'),
      save: document.getElementById('save'),
      load: document.getElementById('load'),
      reset: document.getElementById('reset'),
      exportBtn: document.getElementById('export'),
      autorun: document.getElementById('autorun'),
      state: document.getElementById('state')
    };

    const STARTER = {
      html: `<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo</title>
  </head>
  <body>
    <main>
      <h1>Hello, world ðŸ‘‹</h1>
      <p>Edit the panels on the left. Changes appear here automatically.</p>
      <button id="clickme">Click me</button>
    </main>
  </body>
</html>`,
      css: `:root{ --accent: #ff7a18; }
html,body{ height:100%; }
body{ margin:0; font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:#0b0b0f; color:#f0f2f8; }
main{ display:grid; place-content:center; gap:12px; min-height:100svh; text-align:center; }
h1{ font-size:clamp(32px, 6vw, 54px); margin:0; }
button{ background:var(--accent); border:0; padding:12px 18px; border-radius:12px; font-weight:700; }
button:hover{ filter:brightness(1.05); }
`,
      js: `document.getElementById('clickme').addEventListener('click', () => {
  alert('It works!');
});`
    };

    const STORAGE_KEY = 'live-editor-v1';

    function buildDoc(html, css, js){
      const safeConsole = `
        <script>
          (function(){
            const log = (...a)=>parent.postMessage({type:'console', level:'log', args:a}, '*');
            const warn = (...a)=>parent.postMessage({type:'console', level:'warn', args:a}, '*');
            const error = (...a)=>parent.postMessage({type:'console', level:'error', args:a}, '*');
            console.log = log; console.warn = warn; console.error = error;
            window.addEventListener('error', e=>{
              parent.postMessage({type:'runtime-error', message:e.message}, '*');
            });
          })();
        <\/script>`;
      return `<!DOCTYPE html>
        <html><head><meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <style>${css}\n</style>
        </head><body>
        ${html}
        ${safeConsole}
        <script>\n${js}\n<\/script>
        </body></html>`;
    }

    function render(){
      const doc = buildDoc(els.html.value, els.css.value, els.js.value);
      const blob = new Blob([doc], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      els.frame.src = url;
      // revoke after load
      els.frame.onload = () => setTimeout(()=>URL.revokeObjectURL(url), 1000);
    }

    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify({
        html: els.html.value, css: els.css.value, js: els.js.value
      }));
    }

    function load(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return false;
      try{
        const data = JSON.parse(raw);
        els.html.value = data.html || '';
        els.css.value = data.css || '';
        els.js.value = data.js || '';
        render();
        return true;
      }catch(err){ return false; }
    }

    function reset(){
      els.html.value = STARTER.html;
      els.css.value = STARTER.css;
      els.js.value = STARTER.js;
      render();
    }

    function downloadSingle(){
      const doc = buildDoc(els.html.value, els.css.value, els.js.value);
      const blob = new Blob([doc], {type:'text/html'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'export.html';
      a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href), 1500);
    }

    // Debounced live update
    let t = 0;
    function onInput(){
      if(!els.autorun.checked) return;
      clearTimeout(t);
      t = setTimeout(render, 300);
    }

    els.html.addEventListener('input', onInput);
    els.css.addEventListener('input', onInput);
    els.js.addEventListener('input', onInput);

    // Buttons & Toggles
    els.run.addEventListener('click', render);
    els.save.addEventListener('click', () => { save(); flash('Saved'); });
    els.load.addEventListener('click', () => { load() ? flash('Loaded') : flash('Nothing saved', true); });
    els.reset.addEventListener('click', () => { reset(); flash('Reset to starter'); });
    els.exportBtn.addEventListener('click', downloadSingle);

    // Autorun label
    els.autorun.addEventListener('change', () => {
      els.state.textContent = els.autorun.checked ? 'LIVE' : 'PAUSED';
      els.state.className = els.autorun.checked ? 'live' : 'paused';
    });

    // Keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      const cmd = e.ctrlKey || e.metaKey;
      if(cmd && e.key.toLowerCase() === 'enter'){ e.preventDefault(); render(); }
      if(cmd && e.key.toLowerCase() === 'e'){ e.preventDefault(); els.autorun.checked = !els.autorun.checked; els.autorun.dispatchEvent(new Event('change')); }
    });

    // Little toast
    const flash = (msg, isWarn=false) => {
      const node = document.createElement('div');
      node.textContent = msg;
      node.style.cssText = `position:fixed; left:50%; top:18px; transform:translateX(-50%); padding:10px 14px; border-radius:10px; font-weight:700; background:${isWarn?'#2a1b1b':'#1a1f14'}; border:1px solid var(--muted); color:${isWarn?'var(--err)':'var(--ok)'}; box-shadow:var(--shadow); z-index:9999;`;
      document.body.appendChild(node);
      setTimeout(()=> node.remove(), 1400);
    };

    // Initialize
    if(!load()) reset();

    // Optional: receive console messages from iframe (example wiring for future console pane)
    window.addEventListener('message', (e)=>{
      const data = e.data || {};
      if(data.type === 'runtime-error'){
        flash('Error: ' + data.message, true);
      }
    });
  </script>
</body>
</html>
